SORT is a cross-platform project that runs on multiple platforms, including Windows, Mac OS, and Ubuntu.
It is a fully open-source, meaning that everyone can compile it by himself.

Following are the mandatory software to compile SORT:
* [CMake](https://cmake.org/) (3.1 or higher version, please also put cmake in executable directory so that the script can call it.).
* C++ compiler that compiles C++14. ( MSVC 2015, GCC 6.1 )
* [Blender 2.8](https://www.blender.org/). It is not a mandatory software to run SORT if there is already a resource file. However, since the input scene file is generated by Blender through SORT Blender Plugin, it is necessary to install Blender to generate input scene files.

# Setup Compiling Environment

## Platform Independent Compiling Options
There are only a few compiling options for us to pay attention in SORT CMake generation.

* **CMAKE_BUILD_TYPE**  
This is set 'Release' by default. Choose 'Debug' if you want to generate a debug build. If you only want to build SORT for running it, there is no need to touch this option.
* **SORT_ENABLE_PROFILER**  
This is a very performance sensitive option. It is turned on by default. However, it is totally fine to disable profiling feature in SORT because this will be a pretty big performance issue for reasonable complex scene rendering.
* **SORT_ENABLE_STATS**  
This will enable SORT to output some statistics information after running SORT. It is also turned on by default.
This feature has very limited impact on rendering performance. Leaving it on should be generally fine. However, it is also fine to turn it off if there is no need to check the statistics data after rendering.

## Download Dependencies before Compiling
SORT uses a third-party library that is not deployed with the source code together. In order to compile SORT successfully, it is mandatory to download the dependencies before compiling. Otherwise, it will have trouble locating the library, leading to the error in CMake generation.

To download the dependency files, simply run 'make update_dep' to retrieve it. However, if the script doesn't work somehow, it is also fine to [download](http://45.63.123.194) the file directly. It is necessary to make sure the platform matches the target platform it runs on. The exact folder to put the dependencies should be 'dependencies' in the root folder. It should look like this SORT_Root/dependencies/easy_profiler/(bin/lib/include).

The last resort is to compile the library with [source code](https://github.com/yse/easy_profiler) by yourself. This is not suggested to compile the source code of easy_profiler due to potential changes in different version may cause unknown problems in SORT. The pre-compiled ones are more desired than compiling it by yourself.

## Windows
* **Visual Studio 2015 or above**
It is necessary to install Visual Studio 2015 or above to compile SORT in Windows. And please also make sure that 'msbuild.exe' is in the system 'Path' folder so that the script can run it directly.

## Mac OS
Please install XCode first before compiling in MacOS.

## Ubuntu
Unlike the other two platforms, for which SORT has packed all necessary libararies in the dependency, some of the depedent libraries is OS dependent. SORT doesn't pack those OS dependent libraries with it, it is programmer's responsibility to setup the correct environment before building it, meaning compiling SORT on Ubuntu requires some basic setup first. 

Following is the tools and library needed by SORT and the correct way to install them on Ubuntu (Xenial)
- OpenEXR
  - sudo apt-get install libopenexr-dev
- Boost
  - sudo apt-get install libboost-all-dev
- Clang 6
  - wget -O - https://apt.llvm.org/llvm-snapshot.gpg.key \| sudo apt-key add -
  - sudo apt-add-repository \"deb http://apt.llvm.org/xenial/ llvm-toolchain-xenial-6.0 main\"
  - sudo apt-get update
  - sudo apt-get install -y clang-6.0
- G++ 7, the default version GCC on Ubuntu Xenial won't compile SORT successfully.
  - sudo apt-get install -y software-properties-common
  - sudo add-apt-repository ppa:ubuntu-toolchain-r/test
  - sudo apt update
  - sudo apt install g++-7 -y
  - sudo update-alternatives \-\-install /usr/bin/gcc gcc /usr/bin/gcc-7 60 \-\-slave /usr/bin/g++ g++ /usr/bin/g++-7
  - sudo update-alternatives \-\-config gcc
- Make sure to download the dependency through 'getdep_ubuntu_xenial.sh'
  
Things are a bit easier on Ubuntu (Bionic)
- OpenEXR
  - sudo apt-get install libopenexr-dev
- Boost
  - sudo apt-get install libboost-all-dev
- Clang 6
  - wget -O - https://apt.llvm.org/llvm-snapshot.gpg.key \| sudo apt-key add -
  - sudo apt-add-repository \"deb http://apt.llvm.org/bionic/ llvm-toolchain-bionic-6.0 main\"
  - sudo apt-get update
  - sudo apt-get install -y clang-6.0
- Make sure to download the dependency through 'getdep_ubuntu_bionic.sh'

There is no need to setup G++ on Ubuntu Bionic since the default version comes with the system is already G++7, which is sufficient for compiling SORT.

Unfortunately, due to limited resources, I don't have time trying and maintaining SORT on every single version of Ubuntu. If you happen to build SORT on other version, you need to rebuild OSL library by yourself and setup the rest of the development environment, which you can consult this [OSL main page](https://github.com/imageworks/OpenShadingLanguage) for detail information.

# Compiling SORT

* **make release**  
Generate a release version build. 
* **make debug**  
Generate generate a debug version build.

Of course, it is also possible to manually generate the project and load it by yourself in any proper way you see fit.

# Other Available Commands

* **make update**  
Sync the latest code on Github.
* **make update_dep**  
Retreive the dependencies again.
* **make clean**  
Clean all genearated files and folders.
* **make clean_dep**  
Clean the dependency files.
* **make help**  
Print help message
* **make dep_info**  
Print information about dependencies.
* **make about**  
Print introduction about the project and myself.

# Generated Binary

Only one executable file will be generated. It will be generated in a newly created folder 'bin' in the SORT root folder. For release version build, an executable named 'sort_r' will be generated. For debug version build, it is named 'sort_d'.
